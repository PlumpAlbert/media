# vim:ft=yaml.docker-compose
version: "3"

networks:
  internal:
  proxy:
    name: "${NGINX_PROXY_NETWORK_NAME}"
    external: true

volumes:
  vpn_data:
  radarr_data:
  prowlarr_data:
  sonarr_data:
  overseerr_data:
  torrent_data:
  plex_data:
  tautulli_data:

services:
  vpn:
    container_name: vpn
    image: qmcgaw/gluetun:latest
    restart: unless-stopped
    networks:
      - proxy
      - internal
    cap_add:
      - NET_ADMIN
    volumes:
      - vpn_data:/gluetun
    env_file:
      - stack.env

  radarr:
    image: lscr.io/linuxserver/radarr:latest
    restart: unless-stopped
    depends_on:
      - vpn
      - torrent
      - prowlarr
    networks:
      - proxy
      - internal
    env_file:
      - stack.env
    volumes:
      - radarr_data:/config
      - ${MEDIA}:/data

  prowlarr:
    image: lscr.io/linuxserver/prowlarr:latest
    restart: unless-stopped
    networks:
      - proxy
      - internal
    depends_on:
      - vpn
      - torrent
    env_file:
      - stack.env
    volumes:
      - prowlarr_data:/config

  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    restart: unless-stopped
    networks:
      - proxy
      - internal
    depends_on:
      - vpn
      - torrent
      - prowlarr
    env_file:
      - stack.env
    volumes:
      - sonarr_data:/config
      - ${MEDIA}:/data

  overseerr:
    image: lscr.io/linuxserver/overseerr:latest
    restart: unless-stopped
    networks:
      - proxy
      - internal
    depends_on:
      - vpn
      - sonarr
      - radarr
      - plex
      - tautulli
    volumes:
      - overseerr_data:/config

  torrent:
    image: lscr.io/linuxserver/qbittorrent:latest
    restart: unless-stopped
    networks:
      - proxy
      - internal
    depends_on:
      - vpn
    env_file:
      - stack.env
    volumes:
      - torrent_data:/config
      - ${MEDIA}/downloads:/downloads
      - ${MEDIA}/torrents:/torrents

  plex:
    image: lscr.io/linuxserver/plex:latest
    restart: unless-stopped
    env_file:
      - stack.env
    networks:
      - proxy
      - internal
    volumes:
      - plex_data:/config
      - ${MEDIA}/series:/tv
      - ${MEDIA}/movies:/movies

  tautulli:
    image: lscr.io/linuxserver/tautulli:latest
    restart: unless-stopped
    env_file:
      - stack.env
    networks:
      - proxy
      - internal
    volumes:
      - tautulli_data:/config
    ports:
      - 8181:8181
